<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Word Search Battle Lobby</title>
  <style>
     #grid {
      pointer-events: none;
      }
      table, tr, th, td{
          outline: black solid 1px;
          padding: 5px;
          text-align: center;
      }
      td{
          outline: black solid 1px;
      }
      .lobby-button {
          background-color: rgb(255, 213, 0);
          padding: 5px 10px; /* Adjust padding as needed */
          margin: 5px 0; /* Change margin to stack buttons vertically */
          width: 250px; /* Adjust width as needed */
          cursor: pointer;
          transition-duration: 0.25s;
          display: inline-block; /* Ensure each button takes full width */
      }
      .lobby-button:hover{
          background-color: rgb(255, 255, 255);
      }
      .lobby-container {
          display: top;
      }

      .player-names {
          display: inline-block;
          margin-left: 10px; /* Adjust margin as needed */
      }

      /* Start of Lobby HTML classes */
      .readyTable{
        outline: none;
        width: 100%;
        margin: 2px;
      }
      .ready{
        background-color: lightgreen;
        padding: 50px;
        margin: 2px;
        cursor: pointer;
        outline: none;
        width: 200px;
      }
      .ready:hover{
          outline: black solid 1px;
          transition-duration: 100ms;
      }
      .notReady{
          background-color: lightcoral;
          padding: 50px;
          margin: 2px;
          cursor: pointer;
          outline: none;
          width: 200px;
      }
      .notReady:hover{
          outline-style: solid;
          transition-duration: 100ms;
      }
      .chat{
        background-color: white;
        cursor: scroll;
        text-align: left;
        margin: 2px;
        width: 100%;
        outline: none;
      }
      .textBox{
        background-color: white;
        color: grey;
        cursor: text;
        text-align: left;
        margin: 2px;
      }
      /* Start of Ongoing Game HTML classes */
      .cell{
        outline: none;
        border: none;
        width: 2px;
        height: 2px;
        pointer-events: none;
        margin: 0px;
      }
      .wordButton{
        cursor: pointer;
        background-color: white;
        margin: 0px;
        width: 100%;
        height: 100%;
        pointer-events: auto;
      }
      .wordBank{
        outline: none;
        width: 100%;
      }
      .playerTable{
        outline: none;
        width: 100%;
        margin: 2px;
        text-align: center;
        table-layout: fixed;
      }
      .surrenderButton{
        cursor: pointer;
        background-color: black;
        color: white;
        width: 200px;
      }
      .surrenderButton:hover{
        outline: red solid;
        transition-duration: 100ms;
      }
      .statistic{
        text-align: left;
        outline: none;
      }
      .pageSplit::after{
        clear: both;
        content: "";
      }
      .red{
        cursor: pointer;
        background-color: #ff7e7e;
        margin: 0px;
        width: 100%;
        height: 100%;
        pointer-events: auto;
      }
      .blue{
        cursor: pointer;
        background-color: #5abaff;
        margin: 0px;
        width: 100%;
        height: 100%;
        pointer-events: auto;
      }
      .green{
        cursor: pointer;
        background-color: #7dff36;
        margin: 0px;
        width: 100%;
        height: 100%;
        pointer-events: auto;
      }
      .purple{
        cursor: pointer;
        background-color: #bc90ff;
        margin: 0px;
        width: 100%;
        height: 100%;
        pointer-events: auto;
      }
     .orange{
        cursor: pointer;
        background-color: #f1b81a;
        margin: 0px;
        width: 100%;
        height: 100%;
        pointer-events: auto;
      }
      .wordButton:hover, .red:hover, .blue:hover, .green:hover, .purple:hover{
        outline: blue solid 2px;
      }
  </style>
</head>
<body>

<!-- Game title  -->
<h1 style="text-align:center">
  The Word Search Game
</h1>

<!-- Message for highlightTimer -->
<font size ="5">
  <div style="text-align:center">
    <label id= "timeHighlight"></label><br>
  </div>
</font>

<!-- Message for winner/loser -->
<font size ="5">
  <div style="text-align:center">
    <label id= "stateMessage"></label><br> 
  </div>
</font>

<!-- Display name -->
<h2 id="displayName"; style="text-align:left";>Display name:</h2>

<div id = "InitialLobby"; align="center">
  <!-- Nickname window -->
  <hr>
  <h3>
    Please enter a nickname:
  </h3>
  <form id="nicknameForm" onsubmit="submitNickname(event)">
    <label for="nickname">Nickname:</label><br>
    <input type="text" id="nicknameInput" name="nickname"><br><br>
    <input type="submit" value="Submit">
  </form>

  <hr>

  <!-- Buttons for joining lobbies -->
  <div align="left">
    <div class="lobby-container">
      <button class="lobby-button" id="button0" onclick="joinLobby(1); hide('InitialLobby'); unhide('gameLobby')">0/4</button>
      <div class="player-names" id="playerNamesInServerDisplay1"></div> <!-- Modified line -->
    </div>
    <div class="lobby-container">
        <button class="lobby-button" id="button1" onclick="joinLobby(2); hide('InitialLobby'); unhide('gameLobby')">0/4</button>
        <div class="player-names" id="playerNamesInServerDisplay2"></div> <!-- Modified line -->
    </div>
    <div class="lobby-container">
        <button class="lobby-button" id="button2" onclick="joinLobby(3);hide('InitialLobby'); unhide('gameLobby')">0/4</button>
        <div class="player-names" id="playerNamesInServerDisplay3"></div> <!-- Modified line -->
    </div>
    <div class="lobby-container">
        <button class="lobby-button" id="button3" onclick="joinLobby(4);hide('InitialLobby'); unhide('gameLobby')">0/4</button>
        <div class="player-names" id="playerNamesInServerDisplay4"></div> <!-- Modified line -->
    </div>
    <div class="lobby-container">
        <button class="lobby-button" id="button4" onclick="joinLobby(5);hide('InitialLobby'); unhide('gameLobby')">0/4</button>
        <div class="player-names" id="playerNamesInServerDisplay5"></div> <!-- Modified line -->
    </div>
  </div>


  <!-- TODO: Implement so that a join button corresponds to a unique lobby to prevent overwriting. -->
</div>
<!-- Temporary solution: duplicate 5 game lobbies and 5 ongoingGames -->
<div id="gameLobby">
  <hr>
  <!-- First row, where the player info and ready button is  -->
  <table class="readyTable">
    <!-- Player information -->
    <tr>
      <th style="background-color: lightcoral;" id="readyP0">Player 1</th>
      <th style="background-color: lightskyblue;" id="readyP1">Player 2</th>
      <th style="background-color: lightgreen;" id="readyP2">Player 3</th>
      <th style="background-color: plum;" id="readyP3"> Player 4</th>
    </tr>

    <tr>
        <td style="outline: none"; id="winsP0">-</td>
        <td style="outline: none"; id="winsP1">-</td>
        <td style="outline: none"; id="winsP2">-</td>
        <td style="outline: none"; id="winsP3">-</td>
    </tr>

    <tr>
        <!-- Ready button (toggle) -->
        <td style="background-color: white;">
            <input class="notReady"; type="button"; value="Not Ready"; id="ready0"; onclick="readyUp(1)">
        </td>
        <td style="background-color: white;">
          <input class="notReady"; type="button"; value="Not Ready"; id="ready1"; onclick="readyUp(2)">
      </td>
      <td style="background-color: white;">
          <input class="notReady"; type="button"; value="Not Ready"; id="ready2"; onclick="readyUp(3)">
      </td>
      <td style="background-color: white;">
          <input class="notReady"; type="button"; value="Not Ready"; id="ready3"; onclick="readyUp(4)">
      </td>
    </tr>
  </table>
  <button class="leave-button" style="display: block;" onclick="surrenderFunction()">Leave Game</button>

</div>

<div id="ongoingGame">
  <hr>

<div> <!-- Divider for player info -->
  <table class="playerTable">
      <!-- Player information -->
      <th style="background-color: #f08080;"; id="inGameP0">Player 1</th>
      <th style="background-color: #87cefa;"; id="inGameP1">Player 2</th>
      <th style="background-color: #90ee90;"; id="inGameP2">Player 3</th>
      <th style="background-color: #dda0dd;"; id="inGameP3">Player 4</th>
      <tr>
          <td class="statistic"; id="scoreP0">-</td>
          <td class="statistic"; id="scoreP1">-</td>
          <td class="statistic"; id="scoreP2">-</td>
          <td class="statistic"; id="scoreP3">-</td>
      </tr>
      <tr>
          <td class="statistic"; id="wordsP0">Words found: </td>
          <td class="statistic"; id="wordsP1">Words found: </td>
          <td class="statistic"; id="wordsP2">Words found: </td>
          <td class="statistic"; id="wordsP3">Words found: </td>
      </tr>
  </table>
</div>
<hr>

<div id="pageSplit"> <!-- Section where the page will split into two -->

  <div style="float: left; width: 70%; height: 100%;"> <!-- Divider for Word Search Box -->
      <label id="grid"></label>
  </div>

  <div style="float: left; width: 30%; height: 100%"> <!-- Contents sitting beside the table-->
    <div align="center";> <!-- Divider for surrender button -->
      <input id="surrender"; type="button"; value="SURRENDER"; class="surrenderButton"; onclick="surrenderFunction()">
    </div>

    <div align="right";> <!-- Divider for Word Bank -->
      <table class="wordBank">
          <tr><th style="background-color:rgb(162, 185, 249);">Word Bank</th></tr>
          <tr><td style="outline: black solid 1px; height: 200px; background-color: white;"><p id="wordList"></p></td></tr>
      </table>
    </div>

    <!-- This is the chat box -->
    <div align="right"; id="chatBox";> <!-- For chat -->
      <h2>Chat</h2>
      <div id="msgLog"; style="overflow-x: hidden; overflow-y: scroll; max-height: 400px; min-height: 400px; white-space: pre-line; outline: black solid 1px; text-align: left;";></div>
      <form id="chatForm" onsubmit="submitChatMessage()">
        <input type="text" id="chatInput" name="chatMessage" style="width: 390px"><br><br>
        <input type="submit" value="SEND">
      </form>
    </div>
  </div>
</div>

<br>

<div align="center">
<table style="width: 50%">
  <tr>
    <th>Player</th>
    <th>Position</th>
  </tr>
  <tr>
    <td id="pos0">-</td>
    <td>1st</td>
  </tr>
  <tr>
    <td id="pos1">-</td>
    <td>2nd</td>
  </tr>
  <tr>
    <td id="pos2">-</td>
    <td>3rd</td>
  </tr>
  <tr>
    <td id="pos3">-</td>
    <td>4th</td>
  </tr>
</table>
</div>

</div>

<script>
/*Util hide/unhide functions*/
function hide(id){
  document.getElementById(id).style.display = "none";
}
function unhide(id){
  document.getElementById(id).style.display = "inline";
}

hide("gameLobby");
hide("ongoingGame");


var playersJoined = 0; // Initialize the number of players joined to 0
var maxPlayers = 4; // Set the maximum number of players
var nickname = "(You)";
var currentLobby = null;
var playerNamesInServer = [];
let lobbyNumOfPlayers = [0, 0, 0, 0, 0];
var idx = -1; //the current idx of the player?
var ready;
var surrender = false;
let gameStarted = [0, 0, 0, 0, 0]; // array to tell if a game is started (1 means started)
var iHighlight = 0; //table row to highlight cell
var jHighlight = 0; //table column to highlight cell
var wordFound = false; 

// Create Multidimensional array to store players of each lobby
//player = {name, score, wins, color, readyStatus}
var newPlayer = [nickname, 0, 0];
var lobby1Info = new Array();
var lobby2Info = new Array();
var lobby3Info = new Array();
var lobby4Info = new Array();
var lobby5Info = new Array();

for(var i = 0; i < 5; i++){
  lobby1Info[i] = Array.from(newPlayer);
  lobby2Info[i] = Array.from(newPlayer);
  lobby3Info[i] = Array.from(newPlayer);
  lobby4Info[i] = Array.from(newPlayer);
  lobby5Info[i] = Array.from(newPlayer);
}

var playerNamesInLobby1;
var playerNamesInLobby2;
var playerNamesInLobby3;
var playerNamesInLobby4;
var playerNamesInLobby5;

//Record the ready states of each lobby into variables
var readyLobby1 = [-1,-1,-1,-1];
var readyLobby2 = [-1,-1,-1,-1];
var readyLobby3 = [-1,-1,-1,-1];
var readyLobby4 = [-1,-1,-1,-1];
var readyLobby5 = [-1,-1,-1,-1];
//Record the player ids of each lobby
var playerIds1 = [-1,-1,-1,-1];
var playerIds2 = [-1,-1,-1,-1];
var playerIds3 = [-1,-1,-1,-1];
var playerIds4 = [-1,-1,-1,-1];
var playerIds5 = [-1,-1,-1,-1];
//The chat logs of each lobby
var chatLog1;
var chatLog2;
var chatLog3;
var chatLog4;
var chatLog5;

var playerScores1 = [0,0,0,0];
var playerScores2 = [0,0,0,0];
var playerScores3 = [0,0,0,0];
var playerScores4 = [0,0,0,0];
var playerScores5 = [0,0,0,0];

var playerWins1 = [0,0,0,0];
var playerWins2 = [0,0,0,0];
var playerWins3 = [0,0,0,0];
var playerWins4 = [0,0,0,0];
var playerWins5 = [0,0,0,0];


var connection = null;
var serverUrl;
serverUrl = "ws://" + window.location.hostname + ":9110";
// Create the connection with the server
connection = new WebSocket(serverUrl);

connection.onopen = function (evt) {
  console.log("Client Server Open!");
}

connection.onclose = function (evt) {
  console.log("Client Server Closed!");
}

connection.onmessage = function (evt) {
  var addPlayer = false;
  surrender = false;
  var msg;
  msg = evt.data;

  console.log("Message received: " + msg);
  const obj = JSON.parse(msg);

  // Handling different types of messages received from the server
  if ('PlayerIdx' in obj) { // Message containing player information
    idx = obj.PlayerIdx; // Assuming idx starts from 0
  }
  // Cells the user selected;
  var firstCell = null;
  var secondCell = null;


  // Get the players in each lobby
  playerNamesInLobby1 = obj.Lobby1.PlayerNames;
  playerNamesInLobby2 = obj.Lobby2.PlayerNames;
  playerNamesInLobby3 = obj.Lobby3.PlayerNames;
  playerNamesInLobby4 = obj.Lobby4.PlayerNames;
  playerNamesInLobby5 = obj.Lobby5.PlayerNames;

  // Get the player's ready status
  ready = obj.ready;

  // Update the ready arrays to be used:
  readyLobby1 = obj.Lobby1.ReadiedPlayers;
  readyLobby2 = obj.Lobby2.ReadiedPlayers;
  readyLobby3 = obj.Lobby3.ReadiedPlayers;
  readyLobby4 = obj.Lobby4.ReadiedPlayers;
  readyLobby5 = obj.Lobby5.ReadiedPlayers;

  // Update the player ids arrays to be used:
  playerIds1 = obj.Lobby1.PlayerIds;
  playerIds2 = obj.Lobby2.PlayerIds;
  playerIds3 = obj.Lobby3.PlayerIds;
  playerIds4 = obj.Lobby4.PlayerIds;
  playerIds5 = obj.Lobby5.PlayerIds;

  // Update the chat logs for each lobby
  chatLog1 = obj.Lobby1.chatLog.messages; //lobby 1 chat log
  chatLog2 = obj.Lobby2.chatLog.messages; //lobby 2 chat log
  chatLog3 = obj.Lobby3.chatLog.messages; //lobby 3 chat log
  chatLog4 = obj.Lobby4.chatLog.messages; //lobby 4 chat log
  chatLog5 = obj.Lobby5.chatLog.messages; //lobby 5 chat log

  playerScores1 = obj.Lobby1.PlayerScores;
  playerScores2 = obj.Lobby2.PlayerScores;
  playerScores3 = obj.Lobby3.PlayerScores;
  playerScores4 = obj.Lobby4.PlayerScores;
  playerScores5 = obj.Lobby5.PlayerScores;

  playerWins1 = obj.Lobby1.PlayerWins;
  playerWins2 = obj.Lobby2.PlayerWins;
  playerWins3 = obj.Lobby3.PlayerWins;
  playerWins4 = obj.Lobby4.PlayerWins;
  playerWins5 = obj.Lobby5.PlayerWins;

  // Display the names of the players in each lobby
  updateDisplayPlayersInMainMenu(playerNamesInLobby1, "playerNamesInServerDisplay1");
  updateDisplayPlayersInMainMenu(playerNamesInLobby2, "playerNamesInServerDisplay2");
  updateDisplayPlayersInMainMenu(playerNamesInLobby3, "playerNamesInServerDisplay3");
  updateDisplayPlayersInMainMenu(playerNamesInLobby4, "playerNamesInServerDisplay4");
  updateDisplayPlayersInMainMenu(playerNamesInLobby5, "playerNamesInServerDisplay5");

  // Sets the arrays equal to each other
  lobbyNumOfPlayers = obj.NumOfPlayersInLobby;
  playerNamesInServer = obj.PlayerNamesInServer;
  gameStarted[currentLobby-1] = obj.GameStarted;

  // Update player profile information in game lobby and ongoing game
  function addPlayer2Array(){
    for(var i = 0; i < lobbyNumOfPlayers[0]; i++){
      lobby1Info[i][0] = obj.Lobby1.PlayersInLobby[i].name;
      lobby1Info[i][1] = obj.Lobby1.PlayersInLobby[i].score;
      lobby1Info[i][2] = obj.Lobby1.PlayersInLobby[i].wins;
    }

    for(var i = 0; i < lobbyNumOfPlayers[1]; i++){
      lobby2Info[i][0] = obj.Lobby2.PlayersInLobby[i].name;
      lobby2Info[i][1] = obj.Lobby2.PlayersInLobby[i].score;
      lobby2Info[i][2] = obj.Lobby2.PlayersInLobby[i].wins;
    }

    for(var i = 0; i < lobbyNumOfPlayers[2]; i++){
      lobby3Info[i][0] = obj.Lobby3.PlayersInLobby[i].name;
      lobby3Info[i][1] = obj.Lobby3.PlayersInLobby[i].score;
      lobby3Info[i][2] = obj.Lobby3.PlayersInLobby[i].wins;
    }

    for(var i = 0; i < lobbyNumOfPlayers[3]; i++){
      lobby4Info[i][0] = obj.Lobby4.PlayersInLobby[i].name;
      lobby4Info[i][1] = obj.Lobby4.PlayersInLobby[i].score;
      lobby4Info[i][2] = obj.Lobby4.PlayersInLobby[i].wins;
    }

    for(var i = 0; i < lobbyNumOfPlayers[4]; i++){
      lobby5Info[i][0] = obj.Lobby5.PlayersInLobby[i].name;
      lobby5Info[i][1] = obj.Lobby5.PlayersInLobby[i].score;
      lobby5Info[i][2] = obj.Lobby5.PlayersInLobby[i].wins;
    }
    updateDisplayPlayers();
  }
  // Update the ready status of each player to everyone
  updateDisplayReady();
  // Update the chat log for players
  updateChatDisplay();

  addPlayer2Array();

  updateLeaderboard();

  //sets the nickname variable to what is Displayed and then trims the "Display Name: " part off
  var displayName = document.getElementById("displayName").textContent;
  nickname = displayName.replace("Display name:", "").trim();


  // Update the numbers on the buttons to display the correct number of players
  document.getElementById("button0").textContent = lobbyNumOfPlayers[0] + "/4";
  document.getElementById("button1").textContent = lobbyNumOfPlayers[1] + "/4";
  document.getElementById("button2").textContent = lobbyNumOfPlayers[2] + "/4";
  document.getElementById("button3").textContent = lobbyNumOfPlayers[3] + "/4";
  document.getElementById("button4").textContent = lobbyNumOfPlayers[4] + "/4";

  // Console Message
  console.log("USER: "+idx+" :: Lobby: "+currentLobby);
}


function submitNickname(event) {
  event.preventDefault(); // Prevent form submission

  nickname = document.getElementById("nicknameInput").value;
  if (!nickname) {
    alert("Please enter a nickname.");
    return;
  }

  for(var i = 0; i < 20; i++)
  {
    if(nickname == playerNamesInServer[i])
    {
      alert("Nickname is taken. Please enter a different one.");
      return;
    }
  }

  const userEvent = {
    PlayerIdx: idx,
    PlayerName: nickname
  };

  connection.send(JSON.stringify(userEvent));

  document.getElementById("nicknameInput").value = "";

  // Display the user's nickname in the "Display name" section
  document.getElementById("displayName").textContent = "Display name: " + nickname;

}
// Function to join the lobby
function joinLobby(lobby) {
  if (!nickname) {
    alert("Please enter a nickname.");
    return;
  }

  // if 4 players already in lobby or if the game has already started, disable button
  if((lobbyNumOfPlayers[lobby-1] >= 4) || gameStarted[lobby-1] == 1)
  {
    document.getElementById("button" + (lobby -1)).disabled = true;
    return;
  }


  addPlayer = true;

  // Update the current lobby
  currentLobby = lobby;

  lobbyNumOfPlayers[lobby-1]++;

  // Update the text content of the button to display the number of players joined
  document.getElementById("button" + (lobby - 1)).textContent = lobbyNumOfPlayers[lobby - 1] + "/4";

  const userEvent = {
    PlayerIdx: idx,
    PlayerName: nickname,
    LobbyNum: lobby,
    AddPlayer: addPlayer,
  };
  userEvent[`NumOfPlayersInLobby${lobby}`] = lobbyNumOfPlayers[lobby-1];
  connection.send(JSON.stringify(userEvent));

}
/*
* This function updates the profile information seen in game lobby and ongoing game session "real-time"
*/
function updateDisplayPlayers(){
  var names;
  var scores;
  var wins;

  switch(currentLobby){
    case 1:
      names = playerNamesInLobby1;
      scores = playerScores1;
      wins = playerWins1;
    break;
    case 2:
      names = playerNamesInLobby2;
      scores = playerScores2;
      wins = playerWins2;
    break;
    case 3:
      names = playerNamesInLobby3;
      scores = playerScores3;
      wins = playerWins3;
    break;
    case 4:
      names = playerNamesInLobby4;
      scores = playerScores4;
      wins = playerWins4;
    break;
    case 5:
      names = playerNamesInLobby5;
      scores = playerScores5;
      wins = playerWins5;
    break;
  }

  for(var i = 0; i < lobbyNumOfPlayers[currentLobby-1]; i++){
    document.getElementById("readyP"+i).textContent = names[i];
    document.getElementById("inGameP"+i).textContent = names[i];
    document.getElementById("scoreP"+i).textContent = "Score: "+scores[i];
    document.getElementById("winsP"+i).textContent = "Wins: "+wins[i];
  }
}
/*
* Param:
*   id -> the id of where the grid will be generated
* This function generates the grid for word search
*/
function generateRandomLetter() {
    var letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    return letters.charAt(Math.floor(Math.random() * letters.length));
}

function genTable(id,words){ 
  /*Function to generate word search table*/
  let newTable = '<table style="width: 100%; outline: none; border: none; pointer-events: none">'; 
  for(var i = 0; i < 25; i++){ //number of rows
    newTable += '<tr style="outline: none; border: none; margin: 0px; padding: 0px; pointer-events: none">';
    for(var j = 0; j < 25; j++){ //number of columns
      newTable += '<td class="cell";>';
      var randomLetter = generateRandomLetter();
      newTable += '<input type="button"; id="cell'+i+"_"+j+'"; class="wordButton"; value="'+ randomLetter+ '"; onclick="giveCell(id); scoring()">'; //change this value with input. Add onclick behavior here

      newTable += '</td>';
    }
    newTable += '</tr>';
  }
  newTable += '</table>'

  document.getElementById(id).innerHTML = newTable;
}

/*
* This function checks whether all players are ready to start the game
*/
function checkGameStart(){ //Check if all players are ready; checks every time a ready button is toggled.
  //Count how many players are ready
  let readyCount = 0;
  var readyInfo;
  switch(currentLobby){
    case 1:
      readyInfo = readyLobby1;
      break;
    case 2:
      readyInfo = readyLobby2;
      break;
    case 3:
      readyInfo = readyLobby3;
      break;
    case 4:
      readyInfo = readyLobby4;
      break;
    case 5:
      readyInfo = readyLobby5;
      break;
  }
  for(var i = 0; i < lobbyNumOfPlayers[currentLobby-1]; i++){ //4 maximum players
    if(readyInfo[i] == 1){
      readyCount++;
    }
  }

  if((lobbyNumOfPlayers[currentLobby-1] == readyCount) && (lobbyNumOfPlayers[currentLobby-1] >=2)){
    hide("gameLobby");
    unhide("ongoingGame");
    genTable("grid");
    timerHighlight();
  }
}
/*
* Param:
*   playerNamesInServerInLobby -> a list of players in server
*   displayId -> the id of what was inserted during call
* This function updates the player names in main menu
*/
function updateDisplayPlayersInMainMenu(playerNamesInServerInLobby, displayId) {
  playerNamesInServerDisplay = document.getElementById(displayId);
  var playerNamesInServerHTML = "";

  // Convert array of player names to comma-separated string
  var playerNamesInServerString = playerNamesInServerInLobby.join(", ");

  playerNamesInServerHTML += playerNamesInServerString;
  playerNamesInServerDisplay.innerHTML = playerNamesInServerHTML;
}
/*
* Param:
*   i -> represents the button selected (1-4)
* This function updates the ready status of current instance of player. UserEvent updates.
*/
function readyUp(i) {
  // check if button click is legal by user
  var illegalCheck = false;
  var whatLobby;
  switch(currentLobby){
    case 1:
      whatLobby = playerIds1;
      break;
    case 2:
      whatLobby = playerIds2;
      break;
    case 3:
      whatLobby = playerIds3;
      break;
    case 4:
      whatLobby = playerIds4;
      break;
    case 5:
      whatLobby = playerIds5;
      break;
  }
  if(idx != whatLobby[i-1]){
    document.getElementById("ready"+(i-1)).disabled = true;
    illegalCheck = true;
  }

  if(illegalCheck){ //if there was an illegal button press, return prematurely.
    return;
  }

  // Get the button element by its ID
  var buttonElement = document.getElementById("ready"+(i-1));

  // Remove the existing class (notReady) and add the new class (ready)
  if(buttonElement.className == "notReady"){ //if they are not ready, change their status to ready
    ready = true; //their status visually will be updated in onMessage
    console.log(idx+" Toggled Ready");
  }
  else if(buttonElement.className == "ready"){
    ready = false;
    console.log(idx+" Toggled Not Ready");
  }

  const userEvent = {
    PlayerIdx: idx,
    LobbyNum: currentLobby,
    Ready: ready,
  };

  connection.send(JSON.stringify(userEvent));
}
/*
* This function assists updating the ready table that is broadcast to all players in lobby "real-time"
*/
function updateDisplayReady(){
  var whatLobby;
  switch(currentLobby){
    case 1:
      whatLobby = readyLobby1;
      break;
    case 2:
      whatLobby = readyLobby2;
      break;
    case 3:
      whatLobby = readyLobby3;
      break;
    case 4:
      whatLobby = readyLobby4;
      break;
    case 5:
      whatLobby = readyLobby5;
      break;
  }
  for(var i = 0; i < lobbyNumOfPlayers[currentLobby-1]; i++){
    if(whatLobby[i] != 0){
      document.getElementById("ready"+i).className="ready";
      document.getElementById("ready"+i).value="Ready";
    }
    else if(whatLobby[i] == 0){
      document.getElementById("ready"+i).className="notReady";
      document.getElementById("ready"+i).value="Not Ready";
    }
  }
  checkGameStart(currentLobby);
}
/*
* This function will highlight cells depending on the color
*/
function giveCell(id){
  switch(currentLobby){
    case 1:
      var playerList = playerIds1;
      break;
    case 2:
      var playerList = playerIds2;
      break;
    case 3:
      var playerList = playerIds3;
      break;
    case 4:
      var playerList = playerIds4;
      break;
    case 5:
      var playerList = playerIds5;
      break;
  }
  var index = 0;
  for(var i = 0; i < lobbyNumOfPlayers[currentLobby-1]; i++){
    if(idx == playerList[i]){
      break;
    }
    index++;
  }

  switch(index){
    case 0:
      if(document.getElementById(id).className == "wordButton" || document.getElementById(id).className == "orange"){
        document.getElementById(id).className = "red";
      }
      else{
        document.getElementById(id).className = "wordButton";
      }
      console.log("Cell clicked: "+id);
      break;
    case 1:
      if(document.getElementById(id).className == "wordButton" || document.getElementById(id).className == "orange"){
        document.getElementById(id).className = "blue";
      }
      else{
        document.getElementById(id).className = "wordButton";
      }
      console.log("Cell clicked: "+id);
      break;
    case 2:
      if(document.getElementById(id).className == "wordButton" || document.getElementById(id).className == "orange"){
        document.getElementById(id).className = "green";
      }
      else{
        document.getElementById(id).className = "wordButton";
      }
      console.log("Cell clicked: "+id);
      break;
    case 3:
      if(document.getElementById(id).className == "wordButton" || document.getElementById(id).className == "orange"){
        document.getElementById(id).className = "purple";
      }
      else{
        document.getElementById(id).className = "wordButton";
      }
      console.log("Cell clicked: "+id);
      break;

  }
}

function submitChatMessage(){
  event.preventDefault();

  var text = "["+nickname+"] ";
  text += document.getElementById("chatInput").value;
  text += "\n";

  var sent = true;

  const userEvent = {
    LobbyNum: currentLobby,
    Msg: text,
    MsgSent: sent,
  };

  connection.send(JSON.stringify(userEvent));

  document.getElementById("chatInput").value = "";
  console.log(nickname+" sent a message: "+text);

}

function updateChatDisplay(){
  var chatDisplay = document.getElementById("msgLog");
  switch(currentLobby){
    case 1:
      chatDisplay.textContent = chatLog1;
      console.log(chatLog1);
      break;
    case 2:
      chatDisplay.textContent = chatLog2;
      console.log(chatLog2);
      break;
    case 3:
      chatDisplay.textContent = chatLog3;
      console.log(chatLog3);
      break;
    case 4:
      chatDisplay.textContent = chatLog4;
      console.log(chatLog4);
      break;
    case 5:
      chatDisplay.textContent = chatLog5;
      console.log(chatLog5);
      break;
  }

  document.getElementById("msgLog").scrollTop = document.getElementById("msgLog").scrollHeight; //prevent scroll up
}
// execute when the surrender button is clicked
function surrenderFunction() {
    console.log("surrender button clicked");
    surrender = true;
    hide("gameLobby");
    hide("ongoingGame");
    hide("stateMessage");
    hide("timeHighlight");
    unhide("InitialLobby");

    userEvent = {
      PlayerIdx: idx,
      LobbyNum: currentLobby,
      PlayerName: nickname,
      Surrender: surrender,
    };

    lobbyNumOfPlayers[currentLobby-1]--;

    userEvent[`NumOfPlayersInLobby${currentLobby}`] = lobbyNumOfPlayers[currentLobby-1];
    connection.send(JSON.stringify(userEvent));

    document.getElementById("button" + (currentLobby - 1)).textContent = lobbyNumOfPlayers[currentLobby- 1] + "/4";
  }
//Function will send a request to update the score of players real-time
function scoring(){
  var score = calcScore();
  userEvent = {
    PlayerIdx: idx,
    LobbyNum: currentLobby,
    ScoreRequest: true,
    Score: score,
    PlayerName: nickname,
  }

  connection.send(JSON.stringify(userEvent));
  updateLeaderboard();
}
//This function determines the returning score value
function calcScore(){
  var score = 0;
  for(var i = 0; i < 25; i++){
    for(var j = 0; j < 25; j++){
      if(document.getElementById("cell"+i+"_"+j).className != "wordButton"){
        score += 5;
      }
    }
  }
  return score;
}
//This function updates the display for scoring in ongoing game
function updateLeaderboard(){
  switch(currentLobby){
    case 1:
      for(var i = 0; i < lobbyNumOfPlayers[currentLobby-1]; i++){
      document.getElementById("pos"+i).textContent = lobby1Info[i][0];
      }
      break;
    case 2:
      for(var i = 0; i < lobbyNumOfPlayers[currentLobby-1]; i++){
      document.getElementById("pos"+i).textContent = lobby2Info[i][0];
      }
      break;
    case 3:
      for(var i = 0; i < lobbyNumOfPlayers[currentLobby-1]; i++){
      document.getElementById("pos"+i).textContent = lobby3Info[i][0];
      }
      break;
    case 4:
      for(var i = 0; i < lobbyNumOfPlayers[currentLobby-1]; i++){
      document.getElementById("pos"+i).textContent = lobby4Info[i][0];
      }
      break;
    case 5:
      for(var i = 0; i < lobbyNumOfPlayers[currentLobby-1]; i++){
      document.getElementById("pos"+i).textContent = lobby5Info[i][0];
      }
      break;
  }
}
/*function counts down 30 seconds to highlight the first letter  
of an unfound word until it reaches 0 or a word is found*/
function timerHighlight(){

  var time = 30;
  var elem = document.getElementById('timeHighlight');
  var timer = setInterval(count, 1000);
  
  function count(){
    if (time == -1 || wordFound){
      clearTimeout(timer);

      if(!wordFound){
      document.getElementById("cell"+iHighlight+"_"+jHighlight).className = "orange";
      }
     
      wordFound = false;

      timerHighlight();
    } 
    else{
      elem.innerHTML = time + " seconds until next letter highlighted";
      time--;
    }
  }
}
//function determines winner and outputs respective winner/loser message
function determineWinner(){
  
  var scores;
  
  switch(currentLobby){
    case 1:
      var playerList = playerIds1;
      scores = playerScores1;
      break;
    case 2:
      var playerList = playerIds2;
      scores = playerScores2;
      break;
    case 3:
      var playerList = playerIds3;
      scores = playerScores3;
      break;
    case 4:
      var playerList = playerIds4;
      scores = playerScores4;
      break;
    case 5:
      var playerList = playerIds5;
      scores = playerScores5;
      break;
  }

  //scores = [3, 20, 30, 70]; //test delete later

  var winner = -1;
  var winnerIdx = 0;
  for(var i = 0; i < lobbyNumOfPlayers[currentLobby-1]; i++){
    if(scores[i] > winner){
      winner = scores[i];
      winnerIdx = i;
    }
  }

  var index = 0;
  for(var i = 0; i < lobbyNumOfPlayers[currentLobby-1]; i++){
    if(idx == playerList[i]){
      break;
    }
    index++;
  }
  
  switch(index){
    case 0:
      if(winnerIdx == 0){
        document.getElementById("stateMessage").innerHTML = "You WIN!!!";
      }
      else{
        document.getElementById("stateMessage").innerHTML = "You LOSE";
      }
      break;
    case 1:
      if(winnerIdx == 1){
        document.getElementById("stateMessage").innerHTML = "You WIN!!!";
      }
      else{
        document.getElementById("stateMessage").innerHTML = "You LOSE";
      }
      break;
    case 2:
      if(winnerIdx == 2){
        document.getElementById("stateMessage").innerHTML = "You WIN!!!";
      }
      else{
        document.getElementById("stateMessage").innerHTML = "You LOSE";
      }
      break;
    case 3:
      if(winnerIdx == 3){
        document.getElementById("stateMessage").innerHTML = "You WIN!!!";
      }
      else{
        document.getElementById("stateMessage").innerHTML = "You LOSE";
      }
      break;
    }
  } 
</script>
</body>
</html>
