<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Word Search Battle Lobby</title>
  <style>
      table, tr, th, td{
          border: 2px solid black;
          padding: 5px;
          text-align: center;
      }
      td{
          border: 1px solid black;
      }
      .lobby-button {
          padding: 5px 10px; /* Adjust padding as needed */
          margin: 5px 0; /* Change margin to stack buttons vertically */
          width: 200px; /* Adjust width as needed */
          cursor: pointer;
          transition-duration: 0.25s;
          display: inline-block; /* Ensure each button takes full width */
          background-color: rgb(255, 241, 83);
      }
      .lobby-button:hover{
          background-color: white;
      }
      /* Start of Lobby HTML classes */
      .readyTable{
        border: hidden;
        width: 100%;
        margin: 2px;
      }
      .ready{
        background-color: lightgreen;
        padding: 50px;
        margin: 2px;
        cursor: pointer;
        border: hidden;
        width: 200px;
      }
      .ready:hover{
          outline-style: solid;
          transition-duration: 100ms;
      }
      .notReady{
          background-color: lightcoral;
          padding: 50px;
          margin: 2px;
          cursor: pointer;
          border: hidden;
          width: 200px;
      }
      .notReady:hover{
          outline-style: solid;
          transition-duration: 100ms;
      }
      .chat{
        background-color: white;
        cursor: scroll;
        text-align: left;
        margin: 2px;
        width: 100%;
        border: none;
      }
      .textBox{
        background-color: white;
        color: grey;
        cursor: text;
        text-align: left;
        margin: 2px;
      }
      /* Start of Ongoing Game HTML classes */
      .wordButton{
        cursor: pointer;
        background-color: white;
        border: 1px solid lightgray;
        width: 2px;
        height: 2px;
      }
      .wordButton:hover{
        outline: black solid 2px;
        transition-duration: 100ms;
      }
      .wordBank{
        border: none;
        width: 100%;
      }
      .playerTable{
        border: none;
        width: 100%;
        margin: 2px;
        text-align: center;
        table-layout: fixed;
      }
      .surrenderButton{
        cursor: pointer;
        background-color: black;
        color: white;
        width: 200px;
      }
      .surrenderButton:hover{
        outline: red solid;
        transition-duration: 100ms;
      }
      .statistic{
        text-align: left;
        border: none;
      }
      .pageSplit::after{
        clear: both;
        content: "";
      }
  </style>
</head>
<body>

<!-- Game title  -->
<h1 style="text-align:center">
  The Word Search Game
</h1>

<div id = "InitialLobby">
  <!-- Nickname window -->
  <h2 id="displayName">Display name:</h2>
  <h3 style="text-align:left">
    Please enter a nickname:
  </h3>
  <form id="nicknameForm" onsubmit="submitNickname(event)">
    <label for="nickname">Nickname:</label><br>
    <input type="text" id="nicknameInput" name="nickname"><br><br>
    <input type="submit" value="Submit">
  </form>

  <hr>

  <!-- Buttons for joining lobbies -->
  <div class="lobby-container">
    <button class="lobby-button" id="button0" onclick="joinLobby(1);">0/4</button>
    <div class="player-names" id="PlayerNamesInServerDisplay1"></div> <!-- Modified line -->
  </div>
  <div class="lobby-container">
      <button class="lobby-button" id="button1" onclick="joinLobby(2);">0/4</button>
      <div class="player-names" id="PlayerNamesInServerDisplay2"></div> <!-- Modified line -->
  </div>
  <div class="lobby-container">
      <button class="lobby-button" id="button2" onclick="joinLobby(3);">0/4</button>
      <div class="player-names" id="PlayerNamesInServerDisplay3"></div> <!-- Modified line -->
  </div>
  <div class="lobby-container">
      <button class="lobby-button" id="button3" onclick="joinLobby(4);">0/4</button>
      <div class="player-names" id="PlayerNamesInServerDisplay4"></div> <!-- Modified line -->
  </div>
  <div class="lobby-container">
      <button class="lobby-button" id="button4" onclick="joinLobby(5);">0/4</button>
      <div class="player-names" id="PlayerNamesInServerDisplay5"></div> <!-- Modified line -->
  </div>

  <!-- Lobby information -->
  <div id="lobbyInfo" style="display: none;">
    <h2>Lobby 1</h2>
    <p id="lobbyPlayers">0/4</p>
  </div>
</div>

<!-- Start of lobby HTML ------------------------------------------------------->
<div id="gameLobby">
  <hr>
  <!-- First row, where the player info and ready button is  -->
  <table class="readyTable">
    <!-- Player information -->
    <tr>
      <th style="background-color: lightcoral;" id="readyP0">Player 1</th>
      <th style="background-color: lightskyblue;" id="readyP1">Player 2</th>
      <th style="background-color: lightgreen;" id="readyP2">Player 3</th>
      <th style="background-color: plum;" id="readyP3"> Player 4</th>
    </tr>
    
    <tr>
        <td style="border: none">Wins: #</td>
        <td style="border: none">Wins: #</td>
        <td style="border: none">Wins: #</td>
        <td style="border: none">Wins: #</td>
    </tr>
    <tr>
        <!-- Ready button (toggle) -->
        <td style="background-color: white;">
            <input class="notReady"; type="button"; value="Not Ready"; id="first"; onclick="toggleButton(this)">
        </td>
        <td style="background-color: white;">
            <input class="notReady"; type="button"; value="Not Ready"; id="second"; onclick="toggleButton(this)">
        </td>
        <td style="background-color: white;">
            <input class="notReady"; type="button"; value="Not Ready"; id="third"; onclick="toggleButton(this)">
        </td>
        <td style="background-color: white;">
            <input class="notReady"; type="button"; value="Not Ready"; id="fourth"; onclick="toggleButton(this)">
        </td>
    </tr>
  </table>
</div>

<!-- Start of Ongoing Game HTML ----------------------------------------------->
<div id="ongoingGame">
    <hr>

  <div> <!-- Divider for player info -->
    <table class="playerTable">
        <!-- Player information -->
        <th style="background-color: lightcoral;">Player 1</th>
        <th style="background-color: lightskyblue;">Player 2</th>
        <th style="background-color: lightgreen;">Player 3</th>
        <th style="background-color: plum;">Player 4</th>
        <tr>
            <td class="statistic">SCORE: </td>
            <td class="statistic">SCORE: </td>
            <td class="statistic">SCORE: </td>
            <td class="statistic">SCORE: </td>
        </tr>
        <tr>
            <td class="statistic">Words Found: </td>
            <td class="statistic">Words Found: </td>
            <td class="statistic">Words Found: </td>
            <td class="statistic">Words Found: </td>
        </tr>
    </table>
  </div>
  <hr>

  <div id="pageSplit"> <!-- Section where the page will split into two -->
    <div style="float: left; width: 50%; height: 100%"> <!-- Divider for Word Search Box -->
        <label id = "wordButton"></label>
    </div>

    <div style="float: left; width: 50%; height: 100%"> <!-- Contents sitting beside the table-->
      <div align="center";> <!-- Divider for surrender button -->
        <input id="surrender"; type="button"; value="SURRENDER"; class="surrenderButton">
      </div>

      <div align="right";> <!-- Divider for Word Bank -->
        <table class="wordBank">
            <tr><th style="background-color:rgb(162, 185, 249);">Word Bank</th></tr>
            <tr><td style="border: 1px solid black; height: 200px"><p id="wordList"></p></td></tr>
        </table>
      </div>

      <!-- This is the chat box -->
      <div align="right"; id="chatBox";> <!-- For chat -->
        <table class="chat">
            <tr><th style="background-color:rgb(162, 185, 249);">Chat</th></tr>
            <tr>
                <td style="text-align: left; height: 450px">
                    messages go here
                </td>
            </tr><tr>
                <td class="textBox">
                    Type here...
                </td>
            </tr>
            
        </table>
      </div>
    </div>
  </div>

</div>

<script>
/*Util hide/unhide functions*/
function hide(id){
  document.getElementById(id).style.display = "none";
}
function unhide(id){
  document.getElementById(id).style.display = "inline";
}

hide("gameLobby");
hide("ongoingGame");
hide("chatBox");
  
var playersJoined = 0; // Initialize the number of players joined to 0
var maxPlayers = 4; // Set the maximum number of players
var nickname = "";
var playerNamesInServer = [];
let lobbyNumOfPlayers = [0, 0, 0, 0, 0];
var idx = -1;

var score = 0;
var wins = 0;
var color = "";
var status = false;

var newPlayer = [nickname, score, wins, color, status];

var lobby1Info = [newPlayer, newPlayer, newPlayer, newPlayer];
var lobby2Info = [newPlayer, newPlayer, newPlayer, newPlayer];
var lobby3Info = [newPlayer, newPlayer, newPlayer, newPlayer];
var lobby4Info = [newPlayer, newPlayer, newPlayer, newPlayer];
var lobby5Info = [newPlayer, newPlayer, newPlayer, newPlayer];

console.log["initial: "+lobby1Info[0]];

var connection = null;
var serverUrl;
serverUrl = "ws://" + window.location.hostname + ":9110";
// Create the connection with the server
connection = new WebSocket(serverUrl);

connection.onopen = function (evt) {
  console.log("Client open!");
}

connection.onclose = function (evt) {
  console.log("Client close.");
}

connection.onmessage = function (evt) {
  var msg;
  msg = evt.data;

  console.log("Message received: " + msg);
  const obj = JSON.parse(msg);

  // Handling different types of messages received from the server
  if ('PlayerIdx' in obj) { // Message containing player information
    idx = obj.PlayerIdx; // Assuming idx starts from 0
  }

  // Sets the arrays equal to each other
  lobbyNumOfPlayers = obj.NumOfPlayersInLobby;
  playerNamesInServer = obj.PlayerNamesInServer;

  // Grab player information. Update every event. 
  addPlayer2Array();
  function addPlayer2Array(){
    for(var i = 0; i < lobbyNumOfPlayers[0]; i++){
      lobby1Info[i][0] = obj.Lobby1.PlayersInLobby[i].name;
      lobby1Info[i][1] = obj.Lobby1.PlayersInLobby[i].score;
      lobby1Info[i][2] = obj.Lobby1.PlayersInLobby[i].wins;
      lobby1Info[i][3] = obj.Lobby1.PlayersInLobby[i].color;
      lobby1Info[i][4] = obj.Lobby1.PlayersInLobby[i].readyStatus;

      console.log("[Lobby 1 -> Player"+(i+1)+"]: "+lobby1Info[i][0]+" "+lobby1Info[i][1]+" "+lobby1Info[i][2]+" "+lobby1Info[i][3]+" "+lobby1Info[i][4]);
    }
        
    for(var i = 0; i < lobbyNumOfPlayers[1]; i++){
      lobby2Info[i][0] = obj.Lobby2.PlayersInLobby[i].name;
      lobby2Info[i][1] = obj.Lobby2.PlayersInLobby[i].score;
      lobby2Info[i][2] = obj.Lobby2.PlayersInLobby[i].wins;
      lobby2Info[i][3] = obj.Lobby2.PlayersInLobby[i].color;
      lobby2Info[i][4] = obj.Lobby2.PlayersInLobby[i].readyStatus;
      console.log("[Lobby 2 -> Player"+(i+1)+"]: "+lobby2Info[i][0]+" "+lobby2Info[i][1]+" "+lobby2Info[i][2]+" "+lobby2Info[i][3]+" "+lobby2Info[i][4]);
    }
    
    for(var i = 0; i < lobbyNumOfPlayers[2]; i++){
      lobby3Info[i][0] = obj.Lobby3.PlayersInLobby[i].name;
      lobby3Info[i][1] = obj.Lobby3.PlayersInLobby[i].score;
      lobby3Info[i][2] = obj.Lobby3.PlayersInLobby[i].wins;
      lobby3Info[i][3] = obj.Lobby3.PlayersInLobby[i].color;
      lobby3Info[i][4] = obj.Lobby3.PlayersInLobby[i].readyStatus;
      console.log("[Lobby 3 -> Player"+(i+1)+"]: "+lobby3Info[i][0]+" "+lobby3Info[i][1]+" "+lobby3Info[i][2]+" "+lobby3Info[i][3]+" "+lobby3Info[i][4]);
    }

    for(var i = 0; i < lobbyNumOfPlayers[3]; i++){
      lobby4Info[i][0] = obj.Lobby4.PlayersInLobby[i].name;
      lobby4Info[i][1] = obj.Lobby4.PlayersInLobby[i].score;
      lobby4Info[i][2] = obj.Lobby4.PlayersInLobby[i].wins;
      lobby4Info[i][3] = obj.Lobby4.PlayersInLobby[i].color;
      lobby4Info[i][4] = obj.Lobby4.PlayersInLobby[i].readyStatus;
      console.log("[Lobby 4 -> Player"+(i+1)+"]: "+lobby4Info[i][0]+" "+lobby4Info[i][1]+" "+lobby4Info[i][2]+" "+lobby4Info[i][3]+" "+lobby4Info[i][4]);
    }

    for(var i = 0; i < lobbyNumOfPlayers[4]; i++){
      lobby5Info[i][0] = obj.Lobby5.PlayersInLobby[i].name;
      lobby5Info[i][1] = obj.Lobby5.PlayersInLobby[i].score;
      lobby5Info[i][2] = obj.Lobby5.PlayersInLobby[i].wins;
      lobby5Info[i][3] = obj.Lobby5.PlayersInLobby[i].color;
      lobby5Info[i][4] = obj.Lobby5.PlayersInLobby[i].readyStatus;
      console.log("[Lobby 5 -> Player"+(i+1)+"]: "+lobby5Info[i][0]+" "+lobby5Info[i][1]+" "+lobby5Info[i][2]+" "+lobby5Info[i][3]+" "+lobby5Info[i][4]);
    }
    

  }


  //sets the nickname variable to what is Displayed and then trims the "Display Name: " part off
  var displayName = document.getElementById("displayName").textContent;
  nickname = displayName.replace("Display name:", "").trim();

  // Update the numbers on the buttons to display the correct number of players
  document.getElementById("button0").textContent = lobbyNumOfPlayers[0] + "/4";
  document.getElementById("button1").textContent = lobbyNumOfPlayers[1] + "/4";
  document.getElementById("button2").textContent = lobbyNumOfPlayers[2] + "/4";
  document.getElementById("button3").textContent = lobbyNumOfPlayers[3] + "/4";
  document.getElementById("button4").textContent = lobbyNumOfPlayers[4] + "/4";


}

function submitNickname(event) {
 event.preventDefault(); // Prevent form submission

  nickname = document.getElementById("nicknameInput").value;
  if (!nickname) {
    alert("Please enter a nickname.");
    return;
  }

  for(var i = 0; i < 20; i++)
  {
    if(nickname == playerNamesInServer[i])
    {
      alert("Nickname is taken. Please enter a different one.");
      return;
    }
  }

  const userEvent = {
    PlayerIdx: idx,
    PlayerName: nickname,
    PlayerScore: score,
    PlayerColor: color,
    PlayerStatus: status
  };

  connection.send(JSON.stringify(userEvent));
  document.getElementById("nicknameInput").value = "";

  // Display the user's nickname in the "Display name" section
  document.getElementById("displayName").textContent = "Display name: " + nickname;
}

// Function to join the lobby
function joinLobby(lobby) {
  if (!nickname) {
    alert("Please enter a nickname.");
    return;
  }

  if(lobbyNumOfPlayers[lobby-1] >= 4)
  {
    document.getElementById("button" + (lobby -1)).disabled = true;
    return;
  }

  // Hide the InitialLobby elements
  hide("InitialLobby");
  if(document.getElementById("InitialLobby").style.display == "none"){
    unhide("gameLobby");
    unhide("chatBox");
  }

  lobbyNumOfPlayers[lobby-1]++;

  // Update the text content of the button to display the number of players joined
  document.getElementById("button" + (lobby - 1)).textContent = lobbyNumOfPlayers[lobby - 1] + "/4";

  const userEvent = {
    PlayerIdx: idx,
    PlayerName: nickname,
    LobbyNum: lobby,
  };

  userEvent[`NumOfPlayersInLobby${lobby}`] = lobbyNumOfPlayers[lobby-1];
  connection.send(JSON.stringify(userEvent));
  
}

/* Start of script for Lobby --------------------------------------------------*/

function updateDisplayPlayers(){
  for(var i = 0; i < 4; i++){
    document.getElementById("ready"+i).textContent = lobby1Info[i][0];
  }
}

function toggleButton(id){
  var buttonClass = id.className;
  if(buttonClass == "notReady"){ 
      id.className = "ready";
      id.value = "Ready";
  }
  else{
      id.className = "notReady"; 
      id.value = "Not Ready";
  }
  checkGameStart();

}

function genTable(id){ /*Function to generate word search table*/
  let newTable = '<table style="width: 100%; border: none">'; 
  for(var i = 0; i < 25; i++){ //number of rows
    newTable += '<tr>';
    for(var j = 0; j < 25; j++){ //number of columns
      newTable += '<td class="wordButton">';
      newTable += '?'; //change this value with input
      newTable += '</td>';
    }
    newTable += '</tr>';
  }
  newTable += '</table>'

  document.getElementById(id).innerHTML = newTable;
}

function checkGameStart(){ //Check if all players are ready; checks every time a ready button is toggled. 
    if((first.className == "ready") && (second.className == "ready") && (third.className == "ready") && (fourth.className == "ready")){
      hide("gameLobby");
      unhide("ongoingGame");
      genTable("wordButton");
    }
}

function genReadyTable(id, lobby){
  let newDisplay = '<div id="gameLobby'+lobby+'">';
    newDisplay += '<tr>'
    newDisplay +=  '<th style="background-color: lightcoral;" id="readyP'+lobby+'0">Player 1</th>';
    newDisplay +=  '<th style="background-color: lightskyblue;" id="readyP'+lobby+'1">Player 2</th>';
    newDisplay +=  '<th style="background-color: lightgreen;" id="readyP'+lobby+'2">Player 3</th>';
    newDisplay +=  '<th style="background-color: plum;" id="readyP'+lobby+'3"> Player 4</th>';
    newDisplay += '<tr>'
    newDisplay +=  '<td style="border: none">Wins: #</td>'
    newDisplay +=  '<td style="border: none">Wins: #</td>'
    newDisplay +=  '<td style="border: none">Wins: #</td>'
    newDisplay +=  '<td style="border: none">Wins: #</td>'
    newDisplay +=  '</tr>'
    newDisplay +=  '<tr>'
    newDisplay +=  '<td style="background-color: white;">'
    newDisplay +=  '<input class="notReady"; type="button"; value="Not Ready"; id="first"; onclick="toggleButton(this)">'
    newDisplay +=  '</td>'
    newDisplay +=  '<td style="background-color: white;">'
    newDisplay +=  '<input class="notReady"; type="button"; value="Not Ready"; id="second"; onclick="toggleButton(this)">'
    newDisplay +=  '</td>'
    newDisplay +=  '<td style="background-color: white;">'
    newDisplay +=  '<input class="notReady"; type="button"; value="Not Ready"; id="third"; onclick="toggleButton(this)">'
    newDisplay +=  '</td>'
    newDisplay +=  '<td style="background-color: white;">'
    newDisplay +=  '<input class="notReady"; type="button"; value="Not Ready"; id="fourth"; onclick="toggleButton(this)">'
    newDisplay +=  '</td>'
    newDisplay +=  '</tr>'
    newDisplay +=  '</table>'
    newDisplay +=  '</div>'

    document.getElementById(id).innerHTML = newDisplay;
  }

/* Start of script for Ongoing Game -------------------------------------------*/
</script>
</body>
</html>
