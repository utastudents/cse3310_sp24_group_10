<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Word Search Battle Lobby</title>
  <style>
      table, tr, th, td{
          background-color: white;
          border: 2px solid black;
          padding: 5px;
          text-align: center;
      }
      td{
          border: 1px solid black;
      }
      .lobby-button {
          background-color: rgb(255, 213, 0);
          padding: 5px 10px; /* Adjust padding as needed */
          margin: 5px 0; /* Change margin to stack buttons vertically */
          width: 250px; /* Adjust width as needed */
          cursor: pointer;
          transition-duration: 0.25s;
          display: inline-block; /* Ensure each button takes full width */
      }
      .lobby-button:hover{
          background-color: rgb(255, 255, 255);
      }
      .lobby-container {
          display: top;
      }

      .player-names {
          display: inline-block;
          margin-left: 10px; /* Adjust margin as needed */
      }

      /* Start of Lobby HTML classes */
      .readyTable{
        border: hidden;
        width: 100%;
        margin: 2px;
      }
      .ready{
        background-color: lightgreen;
        padding: 50px;
        margin: 2px;
        cursor: pointer;
        border: hidden;
        width: 200px;
      }
      .ready:hover{
          outline-style: solid;
          transition-duration: 100ms;
      }
      .notReady{
          background-color: lightcoral;
          padding: 50px;
          margin: 2px;
          cursor: pointer;
          border: hidden;
          width: 200px;
      }
      .notReady:hover{
          outline-style: solid;
          transition-duration: 100ms;
      }
      .chat{
        background-color: white;
        cursor: scroll;
        text-align: left;
        margin: 2px;
        width: 100%;
        border: none;
      }
      .textBox{
        background-color: white;
        color: grey;
        cursor: text;
        text-align: left;
        margin: 2px;
      }
      /* Start of Ongoing Game HTML classes */
      .wordButton{
        cursor: pointer;
        background-color: white;
        border: 1px solid lightgray;
        width: 2px;
        height: 2px;
      }
      .wordButton:hover{
        outline: black solid 2px;
        transition-duration: 100ms;
      }
      .wordBank{
        border: none;
        width: 100%;
      }
      .playerTable{
        border: none;
        width: 100%;
        margin: 2px;
        text-align: center;
        table-layout: fixed;
      }
      .surrenderButton{
        cursor: pointer;
        background-color: black;
        color: white;
        width: 200px;
      }
      .surrenderButton:hover{
        outline: red solid;
        transition-duration: 100ms;
      }
      .statistic{
        text-align: left;
        border: none;
      }
      .pageSplit::after{
        clear: both;
        content: "";
      }

  </style>
</head>
<body>

<!-- Game title  -->
<h1 style="text-align:center">
  The Word Search Game
</h1>
<button class="leave-button" style="display: block;" onclick="leaveGame()">Leave Game</button>

<script>
  function leaveGame() {
    window.location.href = "index.html"; 
    document.querySelector('.leave-button').style.display = 'block';
    alert(nickname + ', You have left the game.');
  }

  // execute when the surrender button is clicked
  function surrenderFunction() {
    alert("You surrendered!");
    window.location.href= "index.html";
  }
  var surrenderButton = document.getElementById("surrender");
  surrenderButton.addEventListener("click", surrenderFunction);
</script>

<div id = "InitialLobby">
  <!-- Nickname window -->
  <h2 id="displayName">Display name:</h2>
  <h3 style="text-align:left">
    Please enter a nickname:
  </h3>
  <form id="nicknameForm" onsubmit="submitNickname(event)">
    <label for="nickname">Nickname:</label><br>
    <input type="text" id="nicknameInput" name="nickname"><br><br>
    <input type="submit" value="Submit">
  </form>

  <!-- Buttons for joining lobbies -->
  <div class="lobby-container">
    <button class="lobby-button" id="button0" onclick="joinLobby(1); updateDisplayPlayers(1); hide('InitialLobby'); unhide('gameLobby1')">0/4</button>
    <div class="player-names" id="playerNamesInServerDisplay1"></div> <!-- Modified line -->
  </div>
  <div class="lobby-container">
      <button class="lobby-button" id="button1" onclick="joinLobby(2); updateDisplayPlayers(2); hide('InitialLobby'); unhide('gameLobby2')">0/4</button>
      <div class="player-names" id="playerNamesInServerDisplay2"></div> <!-- Modified line -->
  </div>
  <div class="lobby-container">
      <button class="lobby-button" id="button2" onclick="joinLobby(3); updateDisplayPlayers(3); hide('InitialLobby'); unhide('gameLobby3')">0/4</button>
      <div class="player-names" id="playerNamesInServerDisplay3"></div> <!-- Modified line -->
  </div>
  <div class="lobby-container">
      <button class="lobby-button" id="button3" onclick="joinLobby(4); updateDisplayPlayers(4); hide('InitialLobby'); unhide('gameLobby4')">0/4</button>
      <div class="player-names" id="playerNamesInServerDisplay4"></div> <!-- Modified line -->
  </div>
  <div class="lobby-container">
      <button class="lobby-button" id="button4" onclick="joinLobby(5); updateDisplayPlayers(5); hide('InitialLobby'); unhide('gameLobby5')">0/4</button>
      <div class="player-names" id="playerNamesInServerDisplay5"></div> <!-- Modified line -->
  </div>

  <!-- TODO: Implement so that a join button corresponds to a unique lobby to prevent overwriting. -->
</div>

<div id="gameLobby1">
  <hr>
  <!-- First row, where the player info and ready button is  -->
  <table class="readyTable">
    <!-- Player information -->
    <tr>
      <th style="background-color: lightcoral;" id="readyP10">Player 1</th>
      <th style="background-color: lightskyblue;" id="readyP11">Player 2</th>
      <th style="background-color: lightgreen;" id="readyP12">Player 3</th>
      <th style="background-color: plum;" id="readyP13"> Player 4</th>
    </tr>
    
    <tr>
        <td style="border: none"; id="winsP10">Wins: #</td>
        <td style="border: none"; id="winsP11">Wins: #</td>
        <td style="border: none"; id="winsP12">Wins: #</td>
        <td style="border: none"; id="winsP13">Wins: #</td>
    </tr>

    <tr>
        <!-- Ready button (toggle) -->
        <td style="background-color: white;">
            <input class="notReady"; type="button"; value="Not Ready"; id="ready11"; onclick="readyUp(1,1)">
        </td>
        <td style="background-color: white;">
          <input class="notReady"; type="button"; value="Not Ready"; id="ready12"; onclick="readyUp(1,2)">
      </td>
      <td style="background-color: white;">
          <input class="notReady"; type="button"; value="Not Ready"; id="ready13"; onclick="readyUp(1,3)">
      </td>
      <td style="background-color: white;">
          <input class="notReady"; type="button"; value="Not Ready"; id="ready14"; onclick="readyUp(1,4)">
      </td>
    </tr>
  </table>
  <!-- The button to toggle ready -->
  <input type="button"; value="Toggle Ready"; id="readyButton1";>

</div>
<div id="gameLobby2">
  <hr>
  <!-- First row, where the player info and ready button is  -->
  <table class="readyTable">
    <!-- Player information -->
    <tr>
      <th style="background-color: lightcoral;" id="readyP20">Player 1</th>
      <th style="background-color: lightskyblue;" id="readyP21">Player 2</th>
      <th style="background-color: lightgreen;" id="readyP22">Player 3</th>
      <th style="background-color: plum;" id="readyP23"> Player 4</th>
    </tr>
    
    <tr>
        <td style="border: none"; id="winsP20">Wins: #</td>
        <td style="border: none"; id="winsP21">Wins: #</td>
        <td style="border: none"; id="winsP22">Wins: #</td>
        <td style="border: none"; id="winsP23">Wins: #</td>
    </tr>

    <tr>
        <!-- Ready button (toggle) -->
        <td style="background-color: white;">
            <input class="notReady"; type="button"; value="Not Ready"; id="ready21"; onclick="readyUp(2,1)">
        </td>
        <td style="background-color: white;">
          <input class="notReady"; type="button"; value="Not Ready"; id="ready22"; onclick="readyUp(2,2)">
      </td>
      <td style="background-color: white;">
          <input class="notReady"; type="button"; value="Not Ready"; id="ready23"; onclick="readyUp(2,3)">
      </td>
      <td style="background-color: white;">
          <input class="notReady"; type="button"; value="Not Ready"; id="ready24"; onclick="readyUp(2,4)">
      </td>
    </tr>
  </table>
</div>
<div id="gameLobby3">
  <hr>
  <!-- First row, where the player info and ready button is  -->
  <table class="readyTable">
    <!-- Player information -->
    <tr>
      <th style="background-color: lightcoral;" id="readyP30">Player 1</th>
      <th style="background-color: lightskyblue;" id="readyP31">Player 2</th>
      <th style="background-color: lightgreen;" id="readyP32">Player 3</th>
      <th style="background-color: plum;" id="readyP33"> Player 4</th>
    </tr>
    
    <tr>
        <td style="border: none"; id="winsP30">Wins: #</td>
        <td style="border: none"; id="winsP31">Wins: #</td>
        <td style="border: none"; id="winsP32">Wins: #</td>
        <td style="border: none"; id="winsP33">Wins: #</td>
    </tr>

    <tr>
        <!-- Ready button (toggle) -->
        <td style="background-color: white;">
            <input class="notReady"; type="button"; value="Not Ready"; id="ready31"; onclick="readyUp(3,1)">
        </td>
        <td style="background-color: white;">
          <input class="notReady"; type="button"; value="Not Ready"; id="ready32"; onclick="readyUp(3,2)">
      </td>
      <td style="background-color: white;">
          <input class="notReady"; type="button"; value="Not Ready"; id="ready33"; onclick="readyUp(3,3)">
      </td>
      <td style="background-color: white;">
          <input class="notReady"; type="button"; value="Not Ready"; id="ready34"; onclick="readyUp(3,4)">
      </td>
    </tr>
  </table>
</div>
<div id="gameLobby4">
  <hr>
  <!-- First row, where the player info and ready button is  -->
  <table class="readyTable">
    <!-- Player information -->
    <tr>
      <th style="background-color: lightcoral;" id="readyP40">Player 1</th>
      <th style="background-color: lightskyblue;" id="readyP41">Player 2</th>
      <th style="background-color: lightgreen;" id="readyP42">Player 3</th>
      <th style="background-color: plum;" id="readyP43"> Player 4</th>
    </tr>
    
    <tr>
        <td style="border: none"; id="winsP40">Wins: #</td>
        <td style="border: none"; id="winsP41">Wins: #</td>
        <td style="border: none"; id="winsP42">Wins: #</td>
        <td style="border: none"; id="winsP43">Wins: #</td>
    </tr>

    <tr>
        <!-- Ready button (toggle) -->
        <td style="background-color: white;">
            <input class="notReady"; type="button"; value="Not Ready"; id="ready41"; onclick="readyUp(4,1)">
        </td>
        <td style="background-color: white;">
          <input class="notReady"; type="button"; value="Not Ready"; id="ready42"; onclick="readyUp(4,2)">
      </td>
      <td style="background-color: white;">
          <input class="notReady"; type="button"; value="Not Ready"; id="ready43"; onclick="readyUp(4,3)">
      </td>
      <td style="background-color: white;">
          <input class="notReady"; type="button"; value="Not Ready"; id="ready44"; onclick="readyUp(4,4)">
      </td>
    </tr>
  </table>
</div>
<div id="gameLobby5">
  <hr>
  <!-- First row, where the player info and ready button is  -->
  <table class="readyTable">
    <!-- Player information -->
    <tr>
      <th style="background-color: lightcoral;" id="readyP50">Player 1</th>
      <th style="background-color: lightskyblue;" id="readyP51">Player 2</th>
      <th style="background-color: lightgreen;" id="readyP52">Player 3</th>
      <th style="background-color: plum;" id="readyP53"> Player 4</th>
    </tr>
    
    <tr>
        <td style="border: none"; id="winsP50">Wins: #</td>
        <td style="border: none"; id="winsP51">Wins: #</td>
        <td style="border: none"; id="winsP52">Wins: #</td>
        <td style="border: none"; id="winsP53">Wins: #</td>
    </tr>

    <tr>
        <!-- Ready button (toggle) -->
        <td style="background-color: white;">
            <input class="notReady"; type="button"; value="Not Ready"; id="ready51"; onclick="readyUp(5,1)">
        </td>
        <td style="background-color: white;">
          <input class="notReady"; type="button"; value="Not Ready"; id="ready52"; onclick="readyUp(5,2)">
      </td>
      <td style="background-color: white;">
          <input class="notReady"; type="button"; value="Not Ready"; id="ready53"; onclick="readyUp(5,3)">
      </td>
      <td style="background-color: white;">
          <input class="notReady"; type="button"; value="Not Ready"; id="ready54"; onclick="readyUp(5,4)">
      </td>
    </tr>
  </table>
</div>

<div id="ongoingGame1">
  <hr>

<div> <!-- Divider for player info -->
  <table class="playerTable">
      <!-- Player information -->
      <th style="background-color: lightcoral;"; id="inGameP10">Player 1</th>
      <th style="background-color: lightskyblue;"; id="inGameP11">Player 2</th>
      <th style="background-color: lightgreen;"; id="inGameP12">Player 3</th>
      <th style="background-color: plum;"; id="inGameP13">Player 4</th>
      <tr>
          <td class="statistic"; id="scoreP10">SCORE: </td>
          <td class="statistic"; id="scoreP11">SCORE: </td>
          <td class="statistic"; id="scoreP12">SCORE: </td>
          <td class="statistic"; id="scoreP13">SCORE: </td>
      </tr>
      <tr>
          <td class="statistic"; id="wordsP10">Words Found: </td>
          <td class="statistic"; id="wordsP11">Words Found: </td>
          <td class="statistic"; id="wordsP12">Words Found: </td>
          <td class="statistic"; id="wordsP13">Words Found: </td>
      </tr>
  </table>
</div>
<hr>

<div id="pageSplit"> <!-- Section where the page will split into two -->
  <div style="float: left; width: 50%; height: 100%"> <!-- Divider for Word Search Box -->
      <label id = "wordButton1"></label>
  </div>

  <div style="float: left; width: 50%; height: 100%"> <!-- Contents sitting beside the table-->
    <div align="center";> <!-- Divider for surrender button -->
      <input id="surrender"; type="button"; value="SURRENDER"; class="surrenderButton"; onclick="surrenderFunction()">
    </div>

    <div align="right";> <!-- Divider for Word Bank -->
      <table class="wordBank">
          <tr><th style="background-color:rgb(162, 185, 249);">Word Bank</th></tr>
          <tr><td style="border: 1px solid black; height: 200px"><p id="wordList"></p></td></tr>
      </table>
    </div>

    <!-- This is the chat box -->
    <div align="right"; id="chatBox";> <!-- For chat -->
      <table class="chat">
          <tr><th style="background-color:rgb(162, 185, 249);">Chat</th></tr>
          <tr>
              <td style="text-align: left; height: 450px">
                  messages go here
              </td>
          </tr><tr>
              <td class="textBox">
                  Type here...
              </td>
          </tr>
          
      </table>
    </div>
  </div>
</div>

</div>
<div id="ongoingGame2">
  <hr>

<div> <!-- Divider for player info -->
  <table class="playerTable">
      <!-- Player information -->
      <th style="background-color: lightcoral;"; id="inGameP20">Player 1</th>
      <th style="background-color: lightskyblue;"; id="inGameP21">Player 2</th>
      <th style="background-color: lightgreen;"; id="inGameP22">Player 3</th>
      <th style="background-color: plum;"; id="inGameP23">Player 4</th>
      <tr>
          <td class="statistic"; id="scoreP20">SCORE: </td>
          <td class="statistic"; id="scoreP21">SCORE: </td>
          <td class="statistic"; id="scoreP22">SCORE: </td>
          <td class="statistic"; id="scoreP23">SCORE: </td>
      </tr>
      <tr>
          <td class="statistic"; id="wordsP20">Words Found: </td>
          <td class="statistic"; id="wordsP21">Words Found: </td>
          <td class="statistic"; id="wordsP22">Words Found: </td>
          <td class="statistic"; id="wordsP23">Words Found: </td>
      </tr>
  </table>
</div>
<hr>

<div id="pageSplit"> <!-- Section where the page will split into two -->
  <div style="float: left; width: 50%; height: 100%"> <!-- Divider for Word Search Box -->
      <label id = "wordButton2"></label>
  </div>

  <div style="float: left; width: 50%; height: 100%"> <!-- Contents sitting beside the table-->
    <div align="center";> <!-- Divider for surrender button -->
      <input id="surrender"; type="button"; value="SURRENDER"; class="surrenderButton"; onclick="surrenderFunction()">
    </div>

    <div align="right";> <!-- Divider for Word Bank -->
      <table class="wordBank">
          <tr><th style="background-color:rgb(162, 185, 249);">Word Bank</th></tr>
          <tr><td style="border: 1px solid black; height: 200px"><p id="wordList"></p></td></tr>
      </table>
    </div>

    <!-- This is the chat box -->
    <div align="right"; id="chatBox";> <!-- For chat -->
      <table class="chat">
          <tr><th style="background-color:rgb(162, 185, 249);">Chat</th></tr>
          <tr>
              <td style="text-align: left; height: 450px">
                  messages go here
              </td>
          </tr><tr>
              <td class="textBox">
                  Type here...
              </td>
          </tr>
          
      </table>
    </div>
  </div>
</div>

</div>
<div id="ongoingGame3">
  <hr>

<div> <!-- Divider for player info -->
  <table class="playerTable">
      <!-- Player information -->
      <th style="background-color: lightcoral;"; id="inGameP30">Player 1</th>
      <th style="background-color: lightskyblue;"; id="inGameP31">Player 2</th>
      <th style="background-color: lightgreen;"; id="inGameP32">Player 3</th>
      <th style="background-color: plum;"; id="inGameP33">Player 4</th>
      <tr>
          <td class="statistic"; id="scoreP30">SCORE: </td>
          <td class="statistic"; id="scoreP31">SCORE: </td>
          <td class="statistic"; id="scoreP32">SCORE: </td>
          <td class="statistic"; id="scoreP33">SCORE: </td>
      </tr>
      <tr>
          <td class="statistic"; id="wordsP30">Words Found: </td>
          <td class="statistic"; id="wordsP31">Words Found: </td>
          <td class="statistic"; id="wordsP32">Words Found: </td>
          <td class="statistic"; id="wordsP33">Words Found: </td>
      </tr>
  </table>
</div>
<hr>

<div id="pageSplit"> <!-- Section where the page will split into two -->
  <div style="float: left; width: 50%; height: 100%"> <!-- Divider for Word Search Box -->
      <label id = "wordButton3"></label>
  </div>

  <div style="float: left; width: 50%; height: 100%"> <!-- Contents sitting beside the table-->
    <div align="center";> <!-- Divider for surrender button -->
      <input id="surrender"; type="button"; value="SURRENDER"; class="surrenderButton"; onclick="surrenderFunction()">
    </div>

    <div align="right";> <!-- Divider for Word Bank -->
      <table class="wordBank">
          <tr><th style="background-color:rgb(162, 185, 249);">Word Bank</th></tr>
          <tr><td style="border: 1px solid black; height: 200px"><p id="wordList"></p></td></tr>
      </table>
    </div>

    <!-- This is the chat box -->
    <div align="right"; id="chatBox";> <!-- For chat -->
      <table class="chat">
          <tr><th style="background-color:rgb(162, 185, 249);">Chat</th></tr>
          <tr>
              <td style="text-align: left; height: 450px">
                  messages go here
              </td>
          </tr><tr>
              <td class="textBox">
                  Type here...
              </td>
          </tr>
          
      </table>
    </div>
  </div>
</div>

</div>
<div id="ongoingGame4">
  <hr>

<div> <!-- Divider for player info -->
  <table class="playerTable">
      <!-- Player information -->
      <th style="background-color: lightcoral;"; id="inGameP40">Player 1</th>
      <th style="background-color: lightskyblue;"; id="inGameP41">Player 2</th>
      <th style="background-color: lightgreen;"; id="inGameP42">Player 3</th>
      <th style="background-color: plum;"; id="inGameP43">Player 4</th>
      <tr>
          <td class="statistic"; id="scoreP40">SCORE: </td>
          <td class="statistic"; id="scoreP41">SCORE: </td>
          <td class="statistic"; id="scoreP42">SCORE: </td>
          <td class="statistic"; id="scoreP43">SCORE: </td>
      </tr>
      <tr>
          <td class="statistic"; id="wordsP40">Words Found: </td>
          <td class="statistic"; id="wordsP41">Words Found: </td>
          <td class="statistic"; id="wordsP42">Words Found: </td>
          <td class="statistic"; id="wordsP43">Words Found: </td>
      </tr>
  </table>
</div>
<hr>

<div id="pageSplit"> <!-- Section where the page will split into two -->
  <div style="float: left; width: 50%; height: 100%"> <!-- Divider for Word Search Box -->
      <label id = "wordButton4"></label>
  </div>

  <div style="float: left; width: 50%; height: 100%"> <!-- Contents sitting beside the table-->
    <div align="center";> <!-- Divider for surrender button -->
      <input id="surrender"; type="button"; value="SURRENDER"; class="surrenderButton"; onclick="surrenderFunction()">
    </div>

    <div align="right";> <!-- Divider for Word Bank -->
      <table class="wordBank">
          <tr><th style="background-color:rgb(162, 185, 249);">Word Bank</th></tr>
          <tr><td style="border: 1px solid black; height: 200px"><p id="wordList"></p></td></tr>
      </table>
    </div>

    <!-- This is the chat box -->
    <div align="right"; id="chatBox";> <!-- For chat -->
      <table class="chat">
          <tr><th style="background-color:rgb(162, 185, 249);">Chat</th></tr>
          <tr>
              <td style="text-align: left; height: 450px">
                  messages go here
              </td>
          </tr><tr>
              <td class="textBox">
                  Type here...
              </td>
          </tr>
          
      </table>
    </div>
  </div>
</div>

</div>
<div id="ongoingGame5">
  <hr>

<div> <!-- Divider for player info -->
  <table class="playerTable">
      <!-- Player information -->
      <th style="background-color: lightcoral;"; id="inGameP50">Player 1</th>
      <th style="background-color: lightskyblue;"; id="inGameP51">Player 2</th>
      <th style="background-color: lightgreen;"; id="inGameP52">Player 3</th>
      <th style="background-color: plum;"; id="inGameP53">Player 4</th>
      <tr>
          <td class="statistic"; id="scoreP50">SCORE: </td>
          <td class="statistic"; id="scoreP51">SCORE: </td>
          <td class="statistic"; id="scoreP52">SCORE: </td>
          <td class="statistic"; id="scoreP53">SCORE: </td>
      </tr>
      <tr>
          <td class="statistic"; id="wordsP50">Words Found: </td>
          <td class="statistic"; id="wordsP51">Words Found: </td>
          <td class="statistic"; id="wordsP52">Words Found: </td>
          <td class="statistic"; id="wordsP53">Words Found: </td>
      </tr>
  </table>
</div>
<hr>

<div id="pageSplit"> <!-- Section where the page will split into two -->
  <div style="float: left; width: 50%; height: 100%"> <!-- Divider for Word Search Box -->
      <label id = "wordButton5"></label>
  </div>

  <div style="float: left; width: 50%; height: 100%"> <!-- Contents sitting beside the table-->
    <div align="center";> <!-- Divider for surrender button -->
      <input id="surrender"; type="button"; value="SURRENDER"; class="surrenderButton"; onclick="surrenderFunction()">
    </div>

    <div align="right";> <!-- Divider for Word Bank -->
      <table class="wordBank">
          <tr><th style="background-color:rgb(162, 185, 249);">Word Bank</th></tr>
          <tr><td style="border: 1px solid black; height: 200px"><p id="wordList"></p></td></tr>
      </table>
    </div>

    <!-- This is the chat box -->
    <div align="right"; id="chatBox";> <!-- For chat -->
      <table class="chat">
          <tr><th style="background-color:rgb(162, 185, 249);">Chat</th></tr>
          <tr>
              <td style="text-align: left; height: 450px">
                  messages go here
              </td>
          </tr><tr>
              <td class="textBox">
                  Type here...
              </td>
          </tr>
          
      </table>
    </div>
  </div>
</div>

</div>

<script>
/*Util hide/unhide functions*/
function hide(id){
  document.getElementById(id).style.display = "none";
}
function unhide(id){
  document.getElementById(id).style.display = "inline";
}

hide("gameLobby1");
hide("gameLobby2");
hide("gameLobby3");
hide("gameLobby4");
hide("gameLobby5");
hide("ongoingGame1");
hide("ongoingGame2");
hide("ongoingGame3");
hide("ongoingGame4");
hide("ongoingGame5");

  
var playersJoined = 0; // Initialize the number of players joined to 0
var maxPlayers = 4; // Set the maximum number of players
var nickname = "(You)";
var currentLobby = null;
var playerNamesInServer = [];
let lobbyNumOfPlayers = [0, 0, 0, 0, 0];
var idx = -1; //the current idx of the player?
var ready = false;

// Create Multidimensional array to store players of each lobby
//player = {name, score, wins, color, readyStatus}
var newPlayer = [nickname, 0, 0];
var lobby1Info = new Array();
var lobby2Info = new Array();
var lobby3Info = new Array();
var lobby4Info = new Array();
var lobby5Info = new Array();

for(var i = 0; i < 5; i++){
  lobby1Info[i] = Array.from(newPlayer);
  lobby2Info[i] = Array.from(newPlayer);
  lobby3Info[i] = Array.from(newPlayer);
  lobby4Info[i] = Array.from(newPlayer);
  lobby5Info[i] = Array.from(newPlayer);
}

//Record the ready states of each lobby into variables
var readyLobby1 = [-1,-1,-1,-1];
var readyLobby2 = [-1,-1,-1,-1];
var readyLobby3 = [-1,-1,-1,-1];
var readyLobby4 = [-1,-1,-1,-1];
var readyLobby5 = [-1,-1,-1,-1];


var connection = null;
var serverUrl;
serverUrl = "ws://" + window.location.hostname + ":9110";
// Create the connection with the server
connection = new WebSocket(serverUrl);

connection.onopen = function (evt) {
  console.log("Client Server Open!");
}

connection.onclose = function (evt) {
  console.log("Client Server Closed!");
}

connection.onmessage = function (evt) {

  var addPlayer = false;
  var ready = false;
  var msg;
  msg = evt.data;

  console.log("Message received: " + msg);
  const obj = JSON.parse(msg);

  // Handling different types of messages received from the server
  if ('PlayerIdx' in obj) { // Message containing player information
    idx = obj.PlayerIdx; // Assuming idx starts from 0
  }

  console.log("Which player? --> "+idx);

  // Get the players in each lobby
  var playerNamesInServerInLobby1 = obj.Lobby1.PlayerNames;
  var playerNamesInServerInLobby2 = obj.Lobby2.PlayerNames;
  var playerNamesInServerInLobby3 = obj.Lobby3.PlayerNames;
  var playerNamesInServerInLobby4 = obj.Lobby4.PlayerNames;
  var playerNamesInServerInLobby5 = obj.Lobby5.PlayerNames;

  // Update the ready arrays to be used:
  readyLobby1 = obj.Lobby1.ReadiedPlayers;
  readyLobby2 = obj.Lobby2.ReadiedPlayers;
  readyLobby3 = obj.Lobby3.ReadiedPlayers;
  readyLobby4 = obj.Lobby4.ReadiedPlayers;
  readyLobby5 = obj.Lobby5.ReadiedPlayers;

  // Display the names of the players in each lobby
  updateDisplayPlayersInMainMenu(playerNamesInServerInLobby1, "playerNamesInServerDisplay1");
  updateDisplayPlayersInMainMenu(playerNamesInServerInLobby2, "playerNamesInServerDisplay2");
  updateDisplayPlayersInMainMenu(playerNamesInServerInLobby3, "playerNamesInServerDisplay3");
  updateDisplayPlayersInMainMenu(playerNamesInServerInLobby4, "playerNamesInServerDisplay4");
  updateDisplayPlayersInMainMenu(playerNamesInServerInLobby5, "playerNamesInServerDisplay5");

  // Sets the arrays equal to each other
  lobbyNumOfPlayers = obj.NumOfPlayersInLobby;
  playerNamesInServer = obj.PlayerNamesInServer;

  // Grab player information. Update every event. 
  function addPlayer2Array(){
    for(var i = 0; i < lobbyNumOfPlayers[0]; i++){
      lobby1Info[i][0] = obj.Lobby1.PlayersInLobby[i].name;
      lobby1Info[i][1] = obj.Lobby1.PlayersInLobby[i].score;
      lobby1Info[i][2] = obj.Lobby1.PlayersInLobby[i].wins;
      lobby1Info[i][3] = obj.Lobby1.PlayersInLobby[i].color;
      lobby1Info[i][4] = obj.Lobby1.PlayersInLobby[i].readyStatus;
    }
        
    for(var i = 0; i < lobbyNumOfPlayers[1]; i++){
      lobby2Info[i][0] = obj.Lobby2.PlayersInLobby[i].name;
      lobby2Info[i][1] = obj.Lobby2.PlayersInLobby[i].score;
      lobby2Info[i][2] = obj.Lobby2.PlayersInLobby[i].wins;
      lobby2Info[i][3] = obj.Lobby2.PlayersInLobby[i].color;
      lobby2Info[i][4] = obj.Lobby2.PlayersInLobby[i].readyStatus;
    }
    
    for(var i = 0; i < lobbyNumOfPlayers[2]; i++){
      lobby3Info[i][0] = obj.Lobby3.PlayersInLobby[i].name;
      lobby3Info[i][1] = obj.Lobby3.PlayersInLobby[i].score;
      lobby3Info[i][2] = obj.Lobby3.PlayersInLobby[i].wins;
      lobby3Info[i][3] = obj.Lobby3.PlayersInLobby[i].color;
      lobby3Info[i][4] = obj.Lobby3.PlayersInLobby[i].readyStatus;
    }

    for(var i = 0; i < lobbyNumOfPlayers[3]; i++){
      lobby4Info[i][0] = obj.Lobby4.PlayersInLobby[i].name;
      lobby4Info[i][1] = obj.Lobby4.PlayersInLobby[i].score;
      lobby4Info[i][2] = obj.Lobby4.PlayersInLobby[i].wins;
      lobby4Info[i][3] = obj.Lobby4.PlayersInLobby[i].color;
      lobby4Info[i][4] = obj.Lobby4.PlayersInLobby[i].readyStatus;
    }

    for(var i = 0; i < lobbyNumOfPlayers[4]; i++){
      lobby5Info[i][0] = obj.Lobby5.PlayersInLobby[i].name;
      lobby5Info[i][1] = obj.Lobby5.PlayersInLobby[i].score;
      lobby5Info[i][2] = obj.Lobby5.PlayersInLobby[i].wins;
      lobby5Info[i][3] = obj.Lobby5.PlayersInLobby[i].color;
      lobby5Info[i][4] = obj.Lobby5.PlayersInLobby[i].readyStatus;
    }
    updateDisplayPlayers();
  }

  //sets the nickname variable to what is Displayed and then trims the "Display Name: " part off
  var displayName = document.getElementById("displayName").textContent;
  nickname = displayName.replace("Display name:", "").trim();

  addPlayer2Array();

  // Update the numbers on the buttons to display the correct number of players
  document.getElementById("button0").textContent = lobbyNumOfPlayers[0] + "/4";
  document.getElementById("button1").textContent = lobbyNumOfPlayers[1] + "/4";
  document.getElementById("button2").textContent = lobbyNumOfPlayers[2] + "/4";
  document.getElementById("button3").textContent = lobbyNumOfPlayers[3] + "/4";
  document.getElementById("button4").textContent = lobbyNumOfPlayers[4] + "/4";
}


function submitNickname(event) {
 event.preventDefault(); // Prevent form submission

  nickname = document.getElementById("nicknameInput").value;
  if (!nickname) {
    alert("Please enter a nickname.");
    return;
  }

  for(var i = 0; i < 20; i++)
  {
    if(nickname == playerNamesInServer[i])
    {
      alert("Nickname is taken. Please enter a different one.");
      return;
    }
  }

  const userEvent = {
    PlayerIdx: idx,
    PlayerName: nickname
  };

  connection.send(JSON.stringify(userEvent));

  document.getElementById("nicknameInput").value = "";

  // Display the user's nickname in the "Display name" section
  document.getElementById("displayName").textContent = "Display name: " + nickname;

}
// Function to join the lobby
function joinLobby(lobby) {
  if (!nickname) {
    alert("Please enter a nickname.");
    return;
  }

  if(lobbyNumOfPlayers[lobby-1] >= 4)
  {
    document.getElementById("button" + (lobby -1)).disabled = true;
    return;
  }

  addPlayer = true;

  // Update the current lobby
  currentLobby = lobby;

  lobbyNumOfPlayers[lobby-1]++;

  // Update the text content of the button to display the number of players joined
  document.getElementById("button" + (lobby - 1)).textContent = lobbyNumOfPlayers[lobby - 1] + "/4";

  const userEvent = {
    PlayerIdx: idx,
    PlayerName: nickname,
    LobbyNum: lobby,
    AddPlayer: addPlayer,
  };
  userEvent[`NumOfPlayersInLobby${lobby}`] = lobbyNumOfPlayers[lobby-1];
  connection.send(JSON.stringify(userEvent));
  
}
/* Start of script for Lobby --------------------------------------------------*/
function updateDisplayPlayers(){
  for(var i = 0; i < lobbyNumOfPlayers[0]; i++){
    document.getElementById("readyP1"+i).textContent = lobby1Info[i][0];
    document.getElementById("inGameP1"+i).textContent = lobby1Info[i][0];
    document.getElementById("scoreP1"+i).textContent = "Score: "+lobby1Info[i][1];
    document.getElementById("winsP1"+i).textContent = "Wins: "+lobby1Info[i][2];
  }
  for(var i = 0; i < lobbyNumOfPlayers[1]; i++){
    document.getElementById("readyP2"+i).textContent = lobby2Info[i][0];
    document.getElementById("inGameP2"+i).textContent = lobby2Info[i][0];
    document.getElementById("scoreP2"+i).textContent = "Score: "+lobby2Info[i][1];
    document.getElementById("winsP2"+i).textContent = "Wins: "+lobby2Info[i][2];
  }
  for(var i = 0; i < lobbyNumOfPlayers[2]; i++){
    document.getElementById("readyP3"+i).textContent = lobby3Info[i][0];
    document.getElementById("inGameP3"+i).textContent = lobby3Info[i][0];
    document.getElementById("scoreP3"+i).textContent = "Score: "+lobby3Info[i][1];
    document.getElementById("winsP3"+i).textContent = "Wins: "+lobby3Info[i][2];
  }
  for(var i = 0; i < lobbyNumOfPlayers[3]; i++){
    document.getElementById("readyP4"+i).textContent = lobby4Info[i][0];
    document.getElementById("inGameP4"+i).textContent = lobby4Info[i][0];
    document.getElementById("scoreP4"+i).textContent = "Score: "+lobby4Info[i][1];
    document.getElementById("winsP4"+i).textContent = "Wins: "+lobby4Info[i][2];
  }
  for(var i = 0; i < lobbyNumOfPlayers[4]; i++){
    document.getElementById("readyP5"+i).textContent = lobby5Info[i][0];
    document.getElementById("inGameP5"+i).textContent = lobby5Info[i][0];
    document.getElementById("scoreP5"+i).textContent = "Score: "+lobby5Info[i][1];
    document.getElementById("winsP5"+i).textContent = "Wins: "+lobby5Info[i][2];
  }
}

function genTable(id){ /*Function to generate word search table*/
  let newTable = '<table style="width: 100%; border: none">'; 
  for(var i = 0; i < 25; i++){ //number of rows
    newTable += '<tr>';
    for(var j = 0; j < 25; j++){ //number of columns
      newTable += '<td class="wordButton">';
      newTable += '?'; //change this value with input
      newTable += '</td>';
    }
    newTable += '</tr>';
  }
  newTable += '</table>'

  document.getElementById(id).innerHTML = newTable;
}

function checkGameStart(lobby){ //Check if all players are ready; checks every time a ready button is toggled. 
  //Count how many players are ready
  let readyCount = 0;
  switch(lobby){
    case 1:
      for(var i = 0; i < lobbyNumOfPlayers[lobby-1]; i++){ //4 maximum players
        if(readyLobby1[i] == 1){
          readyCount++;
        }
      }
      break;
    case 2:
      for(var i = 0; i < lobbyNumOfPlayers[lobby-1]; i++){ //4 maximum players
        if(readyLobby2[i] == 1){
          readyCount++;
        }
      }
      break;
    case 3:
      for(var i = 0; i < lobbyNumOfPlayers[lobby-1]; i++){ //4 maximum players
        if(readyLobby3[i] == 1){
          readyCount++;
        }
      }
      break;
    case 4:
      for(var i = 0; i < lobbyNumOfPlayers[lobby-1]; i++){ //4 maximum players
        if(readyLobby4[i] == 1){
          readyCount++;
        }
      }
      break;
    case 5:
      for(var i = 0; i < lobbyNumOfPlayers[lobby-1]; i++){ //4 maximum players
        if(readyLobby5[i] == 1){
          readyCount++;
        }
      }
      break;
  }

  console.log("Total Players in Lobby: "+lobbyNumOfPlayers[lobby-1]);
  console.log("Current ready players: "+readyCount);
  if(lobbyNumOfPlayers[lobby-1] == readyCount){
    hide("gameLobby"+lobby);
    unhide("ongoingGame"+lobby);
    genTable("wordButton"+lobby);
  }
}

function updateDisplayPlayersInMainMenu(playerNamesInServerInLobby, displayId) {
  var playerNamesInServerDisplay = document.getElementById(displayId);
  var playerNamesInServerHTML = "";

  // Convert array of player names to comma-separated string
  var playerNamesInServerString = playerNamesInServerInLobby.join(", ");
  
  playerNamesInServerHTML += playerNamesInServerString;
  playerNamesInServerDisplay.innerHTML = playerNamesInServerHTML;
}

function readyUp(lobby,i) {
  // Get the button element by its ID
  var buttonElement = document.getElementById("ready"+lobby+i);

  // Remove the existing class (notReady) and add the new class (ready)
  if(buttonElement.className == "notReady"){
    ready = true;
    buttonElement.classList.remove("notReady");
    buttonElement.classList.add("ready");

    // Change the value of the button to "Ready"
    buttonElement.value = "Ready";
  }
  else{
    ready = false;
    buttonElement.classList.remove("ready");
    buttonElement.classList.add("notReady");

    // Change the value of the button to "Ready"
    buttonElement.value = "Not Ready";

  }
  

  const userEvent = {
    PlayerIdx: idx,
    LobbyNum: currentLobby,
    Ready: ready,
  };

  connection.send(JSON.stringify(userEvent));

  checkGameStart(lobby);
}

</script>
</body>
</html>