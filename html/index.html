<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Word Search Battle Lobby</title>
  <style>
      table, tr, th, td{
          background-color: white;
          border: 2px solid black;
          padding: 5px;
          text-align: center;
      }
      td{
          border: 1px solid black;
      }
      button{
          padding: 5px 30px;
          margin: 5px 5px;
          width: 200px;
          cursor: pointer;
          transition-duration: 0.25s;
      }
      button:hover{
          background-color: white;
      }
  </style>
</head>
<body>

<!-- Game title  -->
<h1 style="text-align:center">
  The Word Search Game
</h1>


<div>
  <!-- Nickname window -->
  <h2 id="displayName">Display name:</h2>
  <h3 style="text-align:left">
    Please enter a nickname:
  </h3>
  <form id="nicknameForm" onsubmit="submitNickname(event)">
    <label for="nickname">Nickname:</label><br>
    <input type="text" id="nicknameInput" name="nickname"><br><br>
    <input type="submit" value="Submit">
  </form>

  <!-- Buttons for joining lobbies -->
  <button id="button0" onclick="joinLobby(1)">0/4</button>
  <!-- <button id="button1">1/4</button>
  <button id="button2">2/4</button>
  <button id="button3">3/4</button> -->

  <!-- Lobby information -->
  <div id="lobbyInfo" style="display: none;">
    <h2>Lobby 1</h2>
    <p id="lobbyPlayers">0/4</p>
  </div>
</div>



<script>

var playersJoined = 0; // Initialize the number of players joined to 0
var maxPlayers = 4; // Set the maximum number of players
var lobby1NumOfPlayers = 0;
var nickname;

var idx = -1;

var connection = null;

var serverUrl;
serverUrl = "ws://" + window.location.hostname + ":9880";
// Create the connection with the server
connection = new WebSocket(serverUrl);

connection.onopen = function (evt) {
  console.log("open");
}

connection.onclose = function (evt) {
  console.log("close");
}

connection.onmessage = function (evt) {
  var msg;
  msg = evt.data;

  console.log("Message received: " + msg);
  const obj = JSON.parse(msg);

  // Handling different types of messages received from the server
  if ('PlayerIdx' in obj) { // Message containing player information
    idx = obj.PlayerIdx; // Assuming idx starts from 0
  }

  if(obj.NumOfPlayersInLobby != null)
  {
    lobby1NumOfPlayers = obj.NumOfPlayersInLobby
  }

  //sets the nickname variable to what is Displayed and then trims the "Display Name: " part off
  var displayName = document.getElementById("displayName").textContent;
  nickname = displayName.replace("Display name:", "").trim();
}


connection.onopen = function (evt) {
  console.log("open");
}

connection.onclose = function (evt) {
  console.log("close");
}

function submitNickname(event) {
 event.preventDefault(); // Prevent form submission

  const nickname = document.getElementById("nicknameInput").value;
  if (!nickname) {
    alert("Please enter a nickname.");
    return;
  }

  const userEvent = {
    PlayerIdx: idx,
    PlayerName: nickname
  };

  connection.send(JSON.stringify(userEvent));

  document.getElementById("nicknameInput").value = "";

  // Display the user's nickname in the "Display name" section
  document.getElementById("displayName").textContent = "Display name: " + nickname;
}

// Function to join the lobby
function joinLobby(lobby) {
  if (!nickname) {
    alert("Please enter a nickname.");
    return;
  }

  lobby1NumOfPlayers++;
  const userEvent = {
    PlayerIdx: idx,
    PlayerName: nickname,
    LobbyNum: lobby,
    NumOfPlayersInLobby: lobby1NumOfPlayers 
  };
  connection.send(JSON.stringify(userEvent));
}
</script>
</body>
</html>
